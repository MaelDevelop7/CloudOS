<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CloudOS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #282c34;
            color: #abb2bf;
            overflow: hidden;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .window {
            background-color: #3c4046;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: absolute;
            min-width: 300px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            resize: both;
            overflow: hidden;
        }

        .title-bar {
            background-color: #21252b;
            color: #fff;
            padding: 8px 12px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: grab;
            font-weight: bold;
        }

        .title-bar button {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .title-bar button:hover {
            background-color: #c0392b;
        }

        .window-content {
            flex-grow: 1;
            padding: 10px;
            background-color: #3c4046;
            color: #abb2bf;
            display: flex;
            flex-direction: column;
        }

        .window-content textarea,
        .window-content input {
            background-color: #21252b;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 8px;
            color: #abb2bf;
            font-family: monospace;
            outline: none;
        }

        .window-content button {
            background-color: #61afef;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            margin-top: 10px;
        }

        .window-content button:hover {
            background-color: #52a0d9;
        }

        .window-content hr {
            border-color: #555;
            margin: 10px 0;
        }

        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #21252b;
            padding: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            border-top: 1px solid #555;
        }

        .taskbar button {
            background-color: #61afef;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
        }

        .taskbar button:hover {
            background-color: #52a0d9;
        }

        .iframe-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div id="desktop" class="flex-grow relative"></div>

    <div class="taskbar">
        <button onclick="createWindow('Notepad')">Notepad</button>
        <button onclick="createWindow('Terminal')">Terminal</button>
        <button onclick="createWindow('Files')">Files</button>
        <button onclick="createWindow('TicTacToe')">Tic Tac Toe</button>
        <button onclick="createWindow('Navigateur')">Browser</button>
    </div>

    <script>
        let windowCount = 0;

        function createWindow(title, contentToOpen = null) {
            const win = document.createElement("div");
            win.className = "window";
            win.style.zIndex = 10 + windowCount++;
            win.style.left = `${50 + windowCount * 20}px`;
            win.style.top = `${50 + windowCount * 20}px`;

            const bar = document.createElement("div");
            bar.className = "title-bar";

            const titleSpan = document.createElement("span");
            titleSpan.textContent = title;

            const closeBtn = document.createElement("button");
            closeBtn.textContent = "X";
            closeBtn.onclick = () => win.remove();

            bar.appendChild(titleSpan);
            bar.appendChild(closeBtn);
            win.appendChild(bar);

            const content = document.createElement("div");
            content.className = "window-content";

            if (title === "Notepad") {
                const textarea = document.createElement("textarea");
                textarea.style.width = "100%";
                textarea.style.height = "150px";
                textarea.value = contentToOpen !== null ? contentToOpen : localStorage.getItem("notepad") || "";

                const saveBtn = document.createElement("button");
                saveBtn.textContent = "Save";
                saveBtn.onclick = () => {
                    localStorage.setItem("notepad", textarea.value);
                    console.log("Saved!");
                };

                content.appendChild(textarea);
                content.appendChild(document.createElement("br"));
                content.appendChild(saveBtn);
            } else if (title === "Terminal") {
                const output = document.createElement("div");
                output.style.height = "150px";
                output.style.overflowY = "auto";
                output.style.background = "#000";
                output.style.color = "#0f0";
                output.style.fontFamily = "monospace";
                output.style.padding = "5px";
                output.innerHTML = `<div>Welcome to CloudTerminal. Type 'help'.</div>`;

                const input = document.createElement("input");
                input.type = "text";
                input.style.width = "100%";
                input.style.fontFamily = "monospace";

                input.addEventListener("keydown", (e) => {
                    if (e.key === "Enter") {
                        const cmd = input.value.trim();
                        const response = handleCommand(cmd, createWindow);
                        output.innerHTML += `<div><span style="color:#0ff;">$ ${cmd}</span></div>`;
                        if (response === "<clear>") {
                            output.innerHTML = "";
                        } else {
                            output.innerHTML += `<div style="white-space: pre-wrap; font-family: monospace;">${response}</div>`;
                        }
                        output.scrollTop = output.scrollHeight;
                        input.value = "";
                    }
                });

                content.appendChild(output);
                content.appendChild(input);
            } else if (title === "Files") {
                const fileList = document.createElement("ul");
                fileList.style.listStyle = "none";
                fileList.style.padding = "0";

                function refreshFileList() {
                    fileList.innerHTML = "";
                    const files = JSON.parse(localStorage.getItem("files") || "[]");
                    if (files.length === 0) {
                        fileList.innerHTML = "<li>No files created.</li>";
                    } else {
                        files.forEach((file, index) => {
                            const li = document.createElement("li");
                            li.style.marginBottom = "5px";

                            const nameSpan = document.createElement("span");
                            nameSpan.textContent = file.name;
                            nameSpan.style.cursor = "pointer";
                            nameSpan.style.marginRight = "10px";
                            nameSpan.onclick = () => {
                                createWindow("Notepad", file.content);
                            };

                            const delBtn = document.createElement("button");
                            delBtn.textContent = "Delete";
                            delBtn.onclick = () => {
                                files.splice(index, 1);
                                localStorage.setItem("files", JSON.stringify(files));
                                refreshFileList();
                            };

                            li.appendChild(nameSpan);
                            li.appendChild(delBtn);
                            fileList.appendChild(li);
                        });
                    }
                }

                const nameInput = document.createElement("input");
                nameInput.placeholder = "File Name";
                nameInput.style.marginRight = "5px";

                const contentInput = document.createElement("input");
                contentInput.placeholder = "Content";
                contentInput.style.marginRight = "5px";

                const addBtn = document.createElement("button");
                addBtn.textContent = "Create";
                addBtn.onclick = () => {
                    const files = JSON.parse(localStorage.getItem("files") || "[]");
                    if (files.some(f => f.name === nameInput.value)) {
                        console.log("File already exists");
                        return;
                    }
                    files.push({ name: nameInput.value, content: contentInput.value });
                    localStorage.setItem("files", JSON.stringify(files));
                    nameInput.value = "";
                    contentInput.value = "";
                    refreshFileList();
                };

                content.appendChild(nameInput);
                content.appendChild(contentInput);
                content.appendChild(addBtn);
                content.appendChild(document.createElement("hr"));
                content.appendChild(fileList);
                refreshFileList();
            } else if (title === "TicTacToe") {
                const iframeContainer = document.createElement('div');
                iframeContainer.classList.add('iframe-container');

                const iframe = document.createElement('iframe');
                iframe.src = "https://maelgruand1.github.io/TicTac-Game/";
                iframe.title = "Tic Tac Toe Game";
                iframe.setAttribute('allowfullscreen', '');

                iframeContainer.appendChild(iframe);
                content.appendChild(iframeContainer);

                win.style.width = '350px';
                win.style.height = '500px';
            } else if (title === "Navigateur") {
                const iframeContainer = document.createElement('div');
                iframeContainer.classList.add('iframe-container');

                // Barre de recherche Wikipédia
                const searchDiv = document.createElement('div');
                searchDiv.style.marginBottom = '10px';
                searchDiv.style.display = 'flex';

                const searchInput = document.createElement('input');
                searchInput.type = 'text';
                searchInput.placeholder = 'Recherche Wikipédia...';
                searchInput.style.flexGrow = '1';
                searchInput.style.padding = '6px 8px';
                searchInput.style.borderRadius = '4px 0 0 4px';
                searchInput.style.border = '1px solid #555';
                searchInput.style.backgroundColor = '#21252b';
                searchInput.style.color = '#abb2bf';
                searchInput.style.outline = 'none';

                const searchBtn = document.createElement('button');
                searchBtn.textContent = 'Go';
                searchBtn.style.border = '1px solid #555';
                searchBtn.style.borderLeft = 'none';
                searchBtn.style.backgroundColor = '#61afef';
                searchBtn.style.color = 'white';
                searchBtn.style.padding = '6px 12px';
                searchBtn.style.borderRadius = '0 4px 4px 0';
                searchBtn.style.cursor = 'pointer';

                searchBtn.onclick = () => {
                    let query = encodeURIComponent(searchInput.value.trim());
                    if (query) {
                        iframe.src = `https://fr.wikipedia.org/wiki/${query}`;
                    }
                };

                searchDiv.appendChild(searchInput);
                searchDiv.appendChild(searchBtn);

                const iframe = document.createElement('iframe');
                iframe.src = "https://fr.wikipedia.org/wiki/Accueil";
                iframe.title = "Navigateur Wikipédia";
                iframe.style.flexGrow = '1';
                iframe.style.border = 'none';
                iframe.style.borderRadius = '4px';

                iframeContainer.appendChild(searchDiv);
                iframeContainer.appendChild(iframe);

                content.appendChild(iframeContainer);

                win.style.width = '600px';
                win.style.height = '500px';
            }

            win.appendChild(content);

            // Drag & Drop
            let isDragging = false;
            let dragOffsetX = 0;
            let dragOffsetY = 0;

            bar.addEventListener("mousedown", (e) => {
                isDragging = true;
                dragOffsetX = e.clientX - win.offsetLeft;
                dragOffsetY = e.clientY - win.offsetTop;
                win.style.cursor = "grabbing";
                bar.style.cursor = "grabbing";
                win.style.zIndex = 10000;
            });

            window.addEventListener("mouseup", () => {
                if (isDragging) {
                    isDragging = false;
                    win.style.cursor = "default";
                    bar.style.cursor = "grab";
                    win.style.zIndex = 10 + windowCount++;
                }
            });

            window.addEventListener("mousemove", (e) => {
                if (isDragging) {
                    win.style.left = e.clientX - dragOffsetX + "px";
                    win.style.top = e.clientY - dragOffsetY + "px";
                }
            });

            document.getElementById("desktop").appendChild(win);
        }

        function handleCommand(command, createWindowFn) {
            const cmd = command.toLowerCase();

            if (cmd === "help") {
                return `
Available commands:
- help: Show this help message
- clear: Clear the terminal output
- notepad: Open Notepad window
- neofetch: Display system info
- tictactoe: Open Tic Tac Toe game
- browser: Open Wikipedia browser
- files: Open Files manager
`;
            } else if (cmd === "clear") {
                return "<clear>";
            } else if (cmd === "notepad") {
                createWindowFn("Notepad");
                return "Opening Notepad...";
            } else if (cmd === "tictactoe") {
                createWindowFn("TicTacToe");
                return "Opening Tic Tac Toe...";
            } else if (cmd === "browser") {
                createWindowFn("Navigateur");
                return "Opening Browser...";
            } else if (cmd === "files") {
                createWindowFn("Files");
                return "Opening Files manager...";
            } else if (cmd === "neofetch") {
    const ua = navigator.userAgent;
    const platform = navigator.platform;
    const language = navigator.language;
    const cores = navigator.hardwareConcurrency || "unknown";
    const memory = navigator.deviceMemory || "unknown";

    return `
${"███████╗ ██████╗ ██████╗ ███████╗███████╗".split("").join(" ")}
${"██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔════╝".split("").join(" ")}
${"█████╗  ██║   ██║██████╔╝█████╗  █████╗  ".split("").join(" ")}
${"██╔══╝  ██║   ██║██╔═══╝ ██╔══╝  ██╔══╝  ".split("").join(" ")}
${"███████╗╚██████╔╝██║     ███████╗███████╗".split("").join(" ")}
${"╚══════╝ ╚═════╝ ╚═╝     ╚══════╝╚══════╝".split("").join(" ")}
-----------------------------------------------------
User Agent: ${ua}
Platform: ${platform}
Language: ${language}
CPU Cores: ${cores}
Memory (GB): ${memory}
`;
} else {
                return `Command not found: ${command}`;
            }
        }
    </script>
</body>

</html>
